"use strict";(self["webpackChunkfinal_project"]=self["webpackChunkfinal_project"]||[]).push([[104],{4104:function(e,o,t){t.r(o),t.d(o,{default:function(){return j}});var s=t(6768),n=t(4232);const l={class:"d-flex justify-content-between align-items-center my-4"},a={class:"table-responsive"},i={class:"table table-hover align-middle text-nowrap"},d={class:"text-center"},p={class:"text-center"},u={class:"text-center"},c={class:"text-center"},r={class:"btn-group"},h=["onClick"],m=["onClick"];function b(e,o,t,b,k,L){const C=(0,s.g2)("Loading"),v=(0,s.g2)("CouponModal"),f=(0,s.g2)("DelModal");return(0,s.uX)(),(0,s.CE)("div",null,[(0,s.bF)(C,{active:k.isLoading},null,8,["active"]),(0,s.Lk)("div",l,[o[2]||(o[2]=(0,s.Lk)("h2",{class:"h4 fw-bold mb-0"},"優惠券管理",-1)),(0,s.Lk)("button",{class:"btn btn-primary d-flex align-items-center gap-1",onClick:o[0]||(o[0]=e=>L.openCouponModal(!0))},o[1]||(o[1]=[(0,s.Lk)("i",{class:"bi bi-plus-circle"},null,-1),(0,s.eW)(" 建立新的優惠券 ")]))]),(0,s.Lk)("div",a,[(0,s.Lk)("table",i,[o[5]||(o[5]=(0,s.Lk)("thead",{class:"table-light"},[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"名稱"),(0,s.Lk)("th",{class:"text-center"},"折扣百分比"),(0,s.Lk)("th",{class:"text-center"},"到期日"),(0,s.Lk)("th",{class:"text-center"},"狀態"),(0,s.Lk)("th",{class:"text-center"},"操作")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(k.coupons,(e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:t},[(0,s.Lk)("td",null,(0,n.v_)(e.title),1),(0,s.Lk)("td",d,(0,n.v_)(e.percent)+"%",1),(0,s.Lk)("td",p,(0,n.v_)(L.formatDate(e.due_date)),1),(0,s.Lk)("td",u,[(0,s.Lk)("span",{class:(0,n.C4)(["badge",1===e.is_enabled?"bg-success":"bg-secondary"])},(0,n.v_)(1===e.is_enabled?"啟用":"未啟用"),3)]),(0,s.Lk)("td",c,[(0,s.Lk)("div",r,[(0,s.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:o=>L.openCouponModal(!1,e)},o[3]||(o[3]=[(0,s.Lk)("i",{class:"bi bi-pencil-square"},null,-1),(0,s.eW)(" 編輯 ")]),8,h),(0,s.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:o=>L.openDelCouponModal(e)},o[4]||(o[4]=[(0,s.Lk)("i",{class:"bi bi-trash"},null,-1),(0,s.eW)(" 刪除 ")]),8,m)])])]))),128))])])]),(0,s.bF)(v,{coupon:k.tempCoupon,ref:"couponModal",isNew:k.isNew,onUpdateCoupon:L.updateCoupon},null,8,["coupon","isNew","onUpdateCoupon"]),(0,s.bF)(f,{item:k.tempCoupon,ref:"delModal",onDelItem:L.delCoupon},null,8,["item","onDelItem"])])}var k=t(5130);const L={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},C={class:"modal-dialog",role:"document"},v={class:"modal-content"},f={class:"modal-header"},g={class:"modal-title",id:"exampleModalLabel"},w={class:"modal-body"},_={class:"mb-3"},x={class:"mb-3"},M={class:"mb-3"},y={class:"mb-3"},D={class:"mb-3"},N={class:"form-check"},$={class:"modal-footer"};function U(e,o,t,l,a,i){return(0,s.uX)(),(0,s.CE)("div",L,[(0,s.Lk)("div",C,[(0,s.Lk)("div",v,[(0,s.Lk)("div",f,[(0,s.Lk)("h5",g,[(0,s.Lk)("span",null,(0,n.v_)(t.isNew?"新增優惠券":"編輯優惠券"),1)]),o[6]||(o[6]=(0,s.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),(0,s.Lk)("div",w,[(0,s.Lk)("div",_,[o[7]||(o[7]=(0,s.Lk)("label",{for:"title"},"標題",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=e=>a.tempCoupon.title=e),placeholder:"請輸入標題"},null,512),[[k.Jo,a.tempCoupon.title]])]),(0,s.Lk)("div",x,[o[8]||(o[8]=(0,s.Lk)("label",{for:"coupon_code"},"優惠碼",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":o[1]||(o[1]=e=>a.tempCoupon.code=e),placeholder:"請輸入優惠碼"},null,512),[[k.Jo,a.tempCoupon.code]])]),(0,s.Lk)("div",M,[o[9]||(o[9]=(0,s.Lk)("label",{for:"due_date"},"到期日",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=e=>a.due_date=e)},null,512),[[k.Jo,a.due_date]])]),(0,s.Lk)("div",y,[o[10]||(o[10]=(0,s.Lk)("label",{for:"price"},"折扣百分比",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":o[3]||(o[3]=e=>a.tempCoupon.percent=e),placeholder:"請輸入折扣百分比"},null,512),[[k.Jo,a.tempCoupon.percent,void 0,{number:!0}]])]),(0,s.Lk)("div",D,[(0,s.Lk)("div",N,[(0,s.bo)((0,s.Lk)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=e=>a.tempCoupon.is_enabled=e),id:"is_enabled"},null,512),[[k.lH,a.tempCoupon.is_enabled]]),o[11]||(o[11]=(0,s.Lk)("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1))])])]),(0,s.Lk)("div",$,[o[12]||(o[12]=(0,s.Lk)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1)),(0,s.Lk)("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=o=>e.$emit("update-coupon",a.tempCoupon))},"Save changes ")])])])],512)}var A=t(3286),I={props:{coupon:{},isNew:Boolean},data(){return{tempCoupon:{},due_date:""}},watch:{coupon(){this.tempCoupon=this.coupon,console.log(this.tempCoupon.due_date);const e=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");[this.due_date]=e},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[A.A]},S=t(1241);const T=(0,S.A)(I,[["render",U]]);var V=T,E=t(6993),F=t(7442),J={components:{CouponModal:V,DelModal:E.A},data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isLoading:!1,isNew:!1}},methods:{getCoupons(){const e="https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/coupons";this.isLoading=!0,this.$http.get(e).then(e=>{this.coupons=e.data.coupons,this.isLoading=!1})},openCouponModal(e,o){this.isNew=e,this.isNew?this.tempCoupon={due_date:(new Date).getTime()/1e3}:this.tempCoupon={...o},this.$refs.couponModal.showModal()},openDelCouponModal(e){this.tempCoupon={...e};const o=this.$refs.delModal;o.showModal()},updateCoupon(e){this.tempCoupon=e;let o="https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/coupon",t="post";this.isNew||(o=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/coupon/${this.tempCoupon.id}`,t="put"),this.isLoading=!0,this.$http[t](o,{data:this.tempCoupon}).then(e=>{this.isLoading=!1,e.data.success?(this.$refs.couponModal.hideModal(),this.getCoupons(),this.showToast("success",this.isNew?"新增優惠券成功":"更新優惠券成功")):this.showToast("error",this.isNew?"新增優惠券失敗":"更新優惠券失敗")})},delCoupon(){const e=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/coupon/${this.tempCoupon.id}`;this.isLoading=!0,this.$http.delete(e).then(e=>{console.log(e,this.tempCoupon);const o=this.$refs.delModal;o.hideModal(),this.getCoupons()})},formatDate(e){const o=new Date(1e3*e);return o.toISOString().split("T")[0]}},created(){this.getCoupons()},mixins:[F.A]};const X=(0,S.A)(J,[["render",b]]);var j=X}}]);
//# sourceMappingURL=104.825f3c40.js.map