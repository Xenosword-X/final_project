"use strict";(self["webpackChunkfinal_project"]=self["webpackChunkfinal_project"]||[]).push([[394],{1335:function(t,e,a){a.d(e,{A:function(){return k}});var l=a(6768),s=a(4232),d=a(5130);const r={"aria-label":"Page navigation example"},n={class:"pagination justify-content-center"},i=["onClick"];function o(t,e,a,o,u,c){return(0,l.uX)(),(0,l.CE)("nav",r,[(0,l.Lk)("ul",n,[e[0]||(e[0]=(0,l.Lk)("li",{class:"page-item"},[(0,l.Lk)("a",{class:"page-link",href:"#","aria-label":"Previous"},[(0,l.Lk)("span",{"aria-hidden":"true"},"«")])],-1)),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.pages.total_pages,t=>((0,l.uX)(),(0,l.CE)("li",{class:(0,s.C4)(["page-item",{active:t===a.pages.current_page}]),key:t},[(0,l.Lk)("a",{class:"page-link",href:"#",onClick:(0,d.D$)(e=>c.updatePage(t),["prevent"])},(0,s.v_)(t),9,i)],2))),128)),e[1]||(e[1]=(0,l.Lk)("li",{class:"page-item"},[(0,l.Lk)("a",{class:"page-link",href:"#","aria-label":"Next"},[(0,l.Lk)("span",{"aria-hidden":"true"},"»")])],-1))])])}var u={props:["pages"],methods:{updatePage(t){this.$emit("emit-pages",t)}}},c=a(1241);const p=(0,c.A)(u,[["render",o]]);var k=p},2394:function(t,e,a){a.r(e),a.d(e,{default:function(){return z}});var l=a(6768),s=a(4232),d=a(5130);const r={class:"table-responsive"},n={class:"table table-hover align-middle text-nowrap"},i={key:0},o={class:"list-unstyled mb-0"},u={class:"text-end"},c={class:"text-center"},p={class:"d-flex flex-column align-items-center"},k={class:"form-check form-switch"},m=["id","onUpdate:modelValue","onChange"],L={class:"text-center"},h={class:"btn-group"},b=["onClick"],g=["onClick"];function v(t,e,a,v,f,y){const _=(0,l.g2)("Loading"),x=(0,l.g2)("OrderModal"),C=(0,l.g2)("DelModal"),O=(0,l.g2)("Pagination");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(_,{active:f.isLoading},null,8,["active"]),e[3]||(e[3]=(0,l.Lk)("h2",{class:"h4 fw-bold mt-4 mb-3"},"訂單管理",-1)),(0,l.Lk)("div",r,[(0,l.Lk)("table",n,[e[2]||(e[2]=(0,l.Lk)("thead",{class:"table-light"},[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"購買時間"),(0,l.Lk)("th",null,"Email"),(0,l.Lk)("th",null,"購買項目"),(0,l.Lk)("th",{class:"text-end"},"應付金額"),(0,l.Lk)("th",{class:"text-center"},"付款狀態"),(0,l.Lk)("th",{class:"text-center"},"操作")])],-1)),f.orders.length?((0,l.uX)(),(0,l.CE)("tbody",i,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(f.orders,(a,r)=>((0,l.uX)(),(0,l.CE)("tr",{key:r,class:(0,s.C4)({"text-muted":!a.is_paid})},[(0,l.Lk)("td",null,(0,s.v_)(y.formatDate(a.create_at)),1),(0,l.Lk)("td",null,(0,s.v_)(a.user?.email||"無資料"),1),(0,l.Lk)("td",null,[(0,l.Lk)("ul",o,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.products,(t,e)=>((0,l.uX)(),(0,l.CE)("li",{key:e},(0,s.v_)(t.product.title)+" × "+(0,s.v_)(t.qty)+" "+(0,s.v_)(t.product.unit),1))),128))])]),(0,l.Lk)("td",u,(0,s.v_)(t.$filters.currency(a.total)),1),(0,l.Lk)("td",c,[(0,l.Lk)("div",p,[(0,l.Lk)("span",{class:(0,s.C4)(["badge mb-1",a.is_paid?"bg-success":"bg-secondary"])},(0,s.v_)(a.is_paid?"已付款":"未付款"),3),(0,l.Lk)("div",k,[(0,l.bo)((0,l.Lk)("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${a.id}`,"onUpdate:modelValue":t=>a.is_paid=t,onChange:t=>y.updatePaid(a)},null,40,m),[[d.lH,a.is_paid]])])])]),(0,l.Lk)("td",L,[(0,l.Lk)("div",h,[(0,l.Lk)("button",{class:"btn btn-outline-primary btn-sm",onClick:t=>y.openModal(a)},e[0]||(e[0]=[(0,l.Lk)("i",{class:"bi bi-eye"},null,-1),(0,l.eW)(" 檢視 ")]),8,b),(0,l.Lk)("button",{class:"btn btn-outline-danger btn-sm",onClick:t=>y.openDelOrderModal(a)},e[1]||(e[1]=[(0,l.Lk)("i",{class:"bi bi-trash"},null,-1),(0,l.eW)(" 刪除 ")]),8,g)])])],2))),128))])):(0,l.Q3)("",!0)])]),(0,l.bF)(x,{order:f.tempOrder,ref:"orderModal",onUpdatePaid:y.updatePaid},null,8,["order","onUpdatePaid"]),(0,l.bF)(C,{item:f.tempOrder,ref:"delModal",onDelItem:y.delOrder},null,8,["item","onDelItem"]),(0,l.bF)(O,{pages:f.pagination,onEmitPages:y.getOrders},null,8,["pages","onEmitPages"])],64)}var f=a(5340);const y={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},_={class:"modal-dialog modal-xl",role:"document"},x={class:"modal-content border-0"},C={class:"modal-body"},O={class:"row"},w={class:"col-md-4"},E={class:"table"},M={key:0},X={class:"col-md-8"},P={class:"table"},$={key:0},D={key:1},A={key:0,class:"text-success"},F={key:1,class:"text-muted"},I={class:"table"},N={class:"text-end"},K={class:"modal-footer"};function S(t,e,a,d,r,n){return(0,l.uX)(),(0,l.CE)("div",y,[(0,l.Lk)("div",_,[(0,l.Lk)("div",x,[e[15]||(e[15]=(0,l.Lk)("div",{class:"modal-header bg-dark text-white"},[(0,l.Lk)("h5",{class:"modal-title",id:"exampleModalLabel"},[(0,l.Lk)("span",null,"訂單細節")]),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),(0,l.Lk)("div",C,[(0,l.Lk)("div",O,[(0,l.Lk)("div",w,[e[5]||(e[5]=(0,l.Lk)("h3",null,"用戶資料",-1)),(0,l.Lk)("table",E,[r.tempOrder.user?((0,l.uX)(),(0,l.CE)("tbody",M,[(0,l.Lk)("tr",null,[e[1]||(e[1]=(0,l.Lk)("th",{style:{width:"100px"}},"姓名",-1)),(0,l.Lk)("td",null,(0,s.v_)(r.tempOrder.user.name),1)]),(0,l.Lk)("tr",null,[e[2]||(e[2]=(0,l.Lk)("th",null,"Email",-1)),(0,l.Lk)("td",null,(0,s.v_)(r.tempOrder.user.email),1)]),(0,l.Lk)("tr",null,[e[3]||(e[3]=(0,l.Lk)("th",null,"電話",-1)),(0,l.Lk)("td",null,(0,s.v_)(r.tempOrder.user.tel),1)]),(0,l.Lk)("tr",null,[e[4]||(e[4]=(0,l.Lk)("th",null,"地址",-1)),(0,l.Lk)("td",null,(0,s.v_)(r.tempOrder.user.address),1)])])):(0,l.Q3)("",!0)])]),(0,l.Lk)("div",X,[e[12]||(e[12]=(0,l.Lk)("h3",null,"訂單細節",-1)),(0,l.Lk)("table",P,[(0,l.Lk)("tbody",null,[(0,l.Lk)("tr",null,[e[6]||(e[6]=(0,l.Lk)("th",{style:{width:"100px"}},"訂單編號",-1)),(0,l.Lk)("td",null,(0,s.v_)(r.tempOrder.id),1)]),(0,l.Lk)("tr",null,[e[7]||(e[7]=(0,l.Lk)("th",null,"下單時間",-1)),(0,l.Lk)("td",null,(0,s.v_)(n.formatDate(r.tempOrder.create_at)),1)]),(0,l.Lk)("tr",null,[e[8]||(e[8]=(0,l.Lk)("th",null,"付款時間",-1)),(0,l.Lk)("td",null,[r.tempOrder.paid_date?((0,l.uX)(),(0,l.CE)("span",$,(0,s.v_)(n.formatDate(r.tempOrder.paid_date)),1)):((0,l.uX)(),(0,l.CE)("span",D,"時間不正確"))])]),(0,l.Lk)("tr",null,[e[9]||(e[9]=(0,l.Lk)("th",null,"付款狀態",-1)),(0,l.Lk)("td",null,[r.tempOrder.is_paid?((0,l.uX)(),(0,l.CE)("strong",A,"已付款")):((0,l.uX)(),(0,l.CE)("span",F,"尚未付款"))])]),(0,l.Lk)("tr",null,[e[10]||(e[10]=(0,l.Lk)("th",null,"總金額",-1)),(0,l.Lk)("td",null,(0,s.v_)(t.$filters.currency(r.tempOrder.total)),1)])])]),e[13]||(e[13]=(0,l.Lk)("h3",null,"選購商品",-1)),(0,l.Lk)("table",I,[e[11]||(e[11]=(0,l.Lk)("thead",null,[(0,l.Lk)("tr")],-1)),(0,l.Lk)("tbody",null,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.tempOrder.products,e=>((0,l.uX)(),(0,l.CE)("tr",{key:e.id},[(0,l.Lk)("th",null,(0,s.v_)(e.product.title),1),(0,l.Lk)("td",null,(0,s.v_)(e.qty)+" / "+(0,s.v_)(e.product.unit),1),(0,l.Lk)("td",N,(0,s.v_)(t.$filters.currency(e.final_total)),1)]))),128))])])])])]),(0,l.Lk)("div",K,[e[14]||(e[14]=(0,l.Lk)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1)),(0,l.Lk)("button",{type:"button",class:"btn btn-primary",onClick:e[0]||(e[0]=e=>t.$emit("update-order",r.tempOrder))},"確認")])])])],512)}var T=a(3286),j={props:{order:{type:Object,default(){return{}}}},watch:{order(){this.tempOrder=this.order,this.isPaid=this.tempOrder.isPaid}},data(){return{status:{},modal:{},tempOrder:{},isPaid:!1}},methods:{formatDate(t){const e=Number(t);if(!e||isNaN(e))return"無效時間";const a=new Date(1e3*e);return a.toISOString().split("T")[0]}},mixins:[T.A]},U=a(1241);const W=(0,U.A)(j,[["render",S]]);var q=W,Q=a(1335),V={data(){return{orders:[],pagination:{},isLoading:!1,tempOrder:{}}},components:{DelModal:f.A,OrderModal:q,Pagination:Q.A},methods:{getOrders(t=1){const e=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/orders?page=${t}`;this.isLoading=!0,this.$http.get(e).then(t=>{t.data.success&&(this.isLoading=!1,this.orders=t.data.orders,this.pagination=t.data.pagination)}).catch(()=>{this.showToast("error","資料載入失敗")})},openModal(t){this.tempOrder={...t};const e=this.$refs.orderModal;e.showModal()},openDelOrderModal(t){this.tempProduct={...t};const e=this.$refs.delModal;e.showModal()},updatePaid(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/order/${t.id}`,a={is_paid:t.is_paid};this.$http.put(e,{data:a}).then(t=>{this.isLoading=!1,this.getOrders()}).catch(()=>{this.showToast("error","資料更新失敗")})},delOrder(){const t=`https://vue3-course-api.hexschool.io/v2/api/xenosword-api/admin/order/${this.tempOrder.id}`;this.$http.delete(t).then(t=>{const e=this.$refs.delModal;e.hideModal(),this.getOrders()}).catch(()=>{this.showToast("error","資料刪除失敗")})},formatDate(t){const e=Number(t);if(!e||isNaN(e))return"無效時間";const a=new Date(1e3*e);return a.toISOString().split("T")[0]}},created(){this.getOrders()}};const H=(0,U.A)(V,[["render",v]]);var z=H},5340:function(t,e,a){a.d(e,{A:function(){return g}});var l=a(6768),s=a(4232);const d={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},r={class:"modal-dialog",role:"document"},n={class:"modal-content border-0"},i={class:"modal-header bg-danger text-white"},o={class:"modal-title"},u={class:"modal-body"},c={class:"text-danger"},p={class:"modal-footer"};function k(t,e,a,k,m,L){return(0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("div",r,[(0,l.Lk)("div",n,[(0,l.Lk)("div",i,[(0,l.Lk)("h5",o,[(0,l.Lk)("span",null,"刪除 "+(0,s.v_)(a.item.title),1)]),e[1]||(e[1]=(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),(0,l.Lk)("div",u,[e[2]||(e[2]=(0,l.eW)(" 是否刪除 ")),(0,l.Lk)("strong",c,(0,s.v_)(a.item.title),1),e[3]||(e[3]=(0,l.eW)(" (刪除後將無法恢復)。 "))]),(0,l.Lk)("div",p,[e[4]||(e[4]=(0,l.Lk)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1)),(0,l.Lk)("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=e=>t.$emit("del-item"))},"確認刪除 ")])])])],512)}var m=a(3286),L={props:{item:{}},data(){return{modal:""}},mixins:[m.A]},h=a(1241);const b=(0,h.A)(L,[["render",k]]);var g=b}}]);
//# sourceMappingURL=394.bc69a010.js.map