{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass } from \"vue\";\nconst _hoisted_1 = {\n  class: \"d-flex justify-content-between align-items-center my-4\"\n};\nconst _hoisted_2 = {\n  class: \"table-responsive\"\n};\nconst _hoisted_3 = {\n  class: \"table table-hover align-middle text-nowrap\"\n};\nconst _hoisted_4 = {\n  class: \"text-center\"\n};\nconst _hoisted_5 = {\n  class: \"text-center\"\n};\nconst _hoisted_6 = {\n  class: \"text-center\"\n};\nconst _hoisted_7 = {\n  class: \"text-center\"\n};\nconst _hoisted_8 = {\n  class: \"btn-group\"\n};\nconst _hoisted_9 = [\"onClick\"];\nconst _hoisted_10 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Loading = _resolveComponent(\"Loading\");\n  const _component_CouponModal = _resolveComponent(\"CouponModal\");\n  const _component_DelModal = _resolveComponent(\"DelModal\");\n  return _openBlock(), _createElementBlock(\"div\", null, [_createVNode(_component_Loading, {\n    active: $data.isLoading\n  }, null, 8, [\"active\"]), _createElementVNode(\"div\", _hoisted_1, [_cache[2] || (_cache[2] = _createElementVNode(\"h2\", {\n    class: \"h4 fw-bold mb-0\"\n  }, \"優惠券管理\", -1)), _createElementVNode(\"button\", {\n    class: \"btn btn-primary d-flex align-items-center gap-1\",\n    onClick: _cache[0] || (_cache[0] = $event => $options.openCouponModal(true))\n  }, _cache[1] || (_cache[1] = [_createElementVNode(\"i\", {\n    class: \"bi bi-plus-circle\"\n  }, null, -1), _createTextVNode(\" 建立新的優惠券 \")]))]), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"table\", _hoisted_3, [_cache[5] || (_cache[5] = _createElementVNode(\"thead\", {\n    class: \"table-light\"\n  }, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", null, \"名稱\"), _createElementVNode(\"th\", {\n    class: \"text-center\"\n  }, \"折扣百分比\"), _createElementVNode(\"th\", {\n    class: \"text-center\"\n  }, \"到期日\"), _createElementVNode(\"th\", {\n    class: \"text-center\"\n  }, \"狀態\"), _createElementVNode(\"th\", {\n    class: \"text-center\"\n  }, \"操作\")])], -1)), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.coupons, (item, key) => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: key\n    }, [_createElementVNode(\"td\", null, _toDisplayString(item.title), 1), _createElementVNode(\"td\", _hoisted_4, _toDisplayString(item.percent) + \"%\", 1), _createElementVNode(\"td\", _hoisted_5, _toDisplayString($options.formatDate(item.due_date)), 1), _createElementVNode(\"td\", _hoisted_6, [_createElementVNode(\"span\", {\n      class: _normalizeClass([\"badge\", item.is_enabled === 1 ? 'bg-success' : 'bg-secondary'])\n    }, _toDisplayString(item.is_enabled === 1 ? '啟用' : '未啟用'), 3)]), _createElementVNode(\"td\", _hoisted_7, [_createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"button\", {\n      class: \"btn btn-outline-primary btn-sm\",\n      onClick: $event => $options.openCouponModal(false, item)\n    }, _cache[3] || (_cache[3] = [_createElementVNode(\"i\", {\n      class: \"bi bi-pencil-square\"\n    }, null, -1), _createTextVNode(\" 編輯 \")]), 8, _hoisted_9), _createElementVNode(\"button\", {\n      class: \"btn btn-outline-danger btn-sm\",\n      onClick: $event => $options.openDelCouponModal(item)\n    }, _cache[4] || (_cache[4] = [_createElementVNode(\"i\", {\n      class: \"bi bi-trash\"\n    }, null, -1), _createTextVNode(\" 刪除 \")]), 8, _hoisted_10)])])]);\n  }), 128))])])]), _createVNode(_component_CouponModal, {\n    coupon: $data.tempCoupon,\n    ref: \"couponModal\",\n    isNew: $data.isNew,\n    onUpdateCoupon: $options.updateCoupon\n  }, null, 8, [\"coupon\", \"isNew\", \"onUpdateCoupon\"]), _createVNode(_component_DelModal, {\n    item: $data.tempCoupon,\n    ref: \"delModal\",\n    onDelItem: $options.delCoupon\n  }, null, 8, [\"item\", \"onDelItem\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_createVNode","_component_Loading","active","$data","isLoading","_createElementVNode","_hoisted_1","onClick","_cache","$event","$options","openCouponModal","_hoisted_2","_hoisted_3","_Fragment","_renderList","coupons","item","key","_toDisplayString","title","_hoisted_4","percent","_hoisted_5","formatDate","due_date","_hoisted_6","_normalizeClass","is_enabled","_hoisted_7","_hoisted_8","openDelCouponModal","_component_CouponModal","coupon","tempCoupon","ref","isNew","onUpdateCoupon","updateCoupon","_component_DelModal","onDelItem","delCoupon"],"sources":["C:\\Users\\User\\Documents\\GitHub\\final_project\\src\\views\\Coupons.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\r\n<template>\r\n  <div>\r\n    <Loading :active=\"isLoading\" />\r\n\r\n    <div class=\"d-flex justify-content-between align-items-center my-4\">\r\n      <h2 class=\"h4 fw-bold mb-0\">優惠券管理</h2>\r\n      <button class=\"btn btn-primary d-flex align-items-center gap-1\" @click=\"openCouponModal(true)\">\r\n        <i class=\"bi bi-plus-circle\"></i> 建立新的優惠券\r\n      </button>\r\n    </div>\r\n\r\n    <div class=\"table-responsive\">\r\n      <table class=\"table table-hover align-middle text-nowrap\">\r\n        <thead class=\"table-light\">\r\n          <tr>\r\n            <th>名稱</th>\r\n            <th class=\"text-center\">折扣百分比</th>\r\n            <th class=\"text-center\">到期日</th>\r\n            <th class=\"text-center\">狀態</th>\r\n            <th class=\"text-center\">操作</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr v-for=\"(item, key) in coupons\" :key=\"key\">\r\n            <td>{{ item.title }}</td>\r\n            <td class=\"text-center\">{{ item.percent }}%</td>\r\n            <td class=\"text-center\">{{ formatDate(item.due_date) }}</td>\r\n            <td class=\"text-center\">\r\n              <span class=\"badge\" :class=\"item.is_enabled === 1 ? 'bg-success' : 'bg-secondary'\">\r\n                {{ item.is_enabled === 1 ? '啟用' : '未啟用' }}\r\n              </span>\r\n            </td>\r\n            <td class=\"text-center\">\r\n              <div class=\"btn-group\">\r\n                <button class=\"btn btn-outline-primary btn-sm\" @click=\"openCouponModal(false, item)\">\r\n                  <i class=\"bi bi-pencil-square\"></i> 編輯\r\n                </button>\r\n                <button class=\"btn btn-outline-danger btn-sm\" @click=\"openDelCouponModal(item)\">\r\n                  <i class=\"bi bi-trash\"></i> 刪除\r\n                </button>\r\n              </div>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n    <CouponModal :coupon=\"tempCoupon\" ref=\"couponModal\" :isNew=\"isNew\"\r\n      @update-coupon=\"updateCoupon\"\r\n    />\r\n    <DelModal :item=\"tempCoupon\" ref=\"delModal\" @del-item=\"delCoupon\"/>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport CouponModal from '@/components/CouponModal.vue'\r\nimport DelModal from '@/components/DelModal.vue'\r\nimport ToastMessage from '@/mixins/ToastMessage'\r\nexport default {\r\n  components: {\r\n    CouponModal,\r\n    DelModal\r\n  },\r\n  /* props: {\r\n    config: Object\r\n  }, */\r\n  data () {\r\n    return {\r\n      coupons: {},\r\n      tempCoupon: {\r\n        title: '',\r\n        is_enabled: 0,\r\n        percent: 100,\r\n        code: ''\r\n      },\r\n      isLoading: false,\r\n      isNew: false\r\n    }\r\n  },\r\n  methods: {\r\n    getCoupons () {\r\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`\r\n      this.isLoading = true\r\n      this.$http.get(api)\r\n        .then((res) => {\r\n          this.coupons = res.data.coupons\r\n          this.isLoading = false\r\n        })\r\n    },\r\n    openCouponModal (isNew, item) {\r\n      this.isNew = isNew\r\n      if (this.isNew) {\r\n        this.tempCoupon = {\r\n          due_date: new Date().getTime() / 1000\r\n        }\r\n      } else {\r\n        this.tempCoupon = { ...item }\r\n      }\r\n      this.$refs.couponModal.showModal()\r\n    },\r\n    openDelCouponModal (item) {\r\n      this.tempCoupon = { ...item }\r\n      const delComponent = this.$refs.delModal\r\n      delComponent.showModal()\r\n    },\r\n    updateCoupon (tempCoupon) {\r\n      this.tempCoupon = tempCoupon\r\n      let api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`\r\n      let httpMethod = 'post'\r\n      // 如果不是新增，改用 put 並補上 id\r\n      if (!this.isNew) {\r\n        api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`\r\n        httpMethod = 'put'\r\n      }\r\n      this.isLoading = true\r\n      this.$http[httpMethod](api, { data: this.tempCoupon })\r\n        .then((res) => {\r\n          this.isLoading = false\r\n          if (res.data.success) {\r\n            this.$refs.couponModal.hideModal()\r\n            this.getCoupons()\r\n            this.showToast(\r\n              'success',\r\n              this.isNew ? '新增優惠券成功' : '更新優惠券成功'\r\n            )\r\n          } else {\r\n            this.showToast(\r\n              'error',\r\n              this.isNew ? '新增優惠券失敗' : '更新優惠券失敗'\r\n            )\r\n          }\r\n        })\r\n    },\r\n    delCoupon () {\r\n      const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`\r\n      this.isLoading = true\r\n      this.$http.delete(url).then((response) => {\r\n        console.log(response, this.tempCoupon)\r\n        const delComponent = this.$refs.delModal\r\n        delComponent.hideModal()\r\n        this.getCoupons()\r\n      })\r\n    },\r\n    formatDate (timestamp) {\r\n      const date = new Date(timestamp * 1000)\r\n      return date.toISOString().split('T')[0]\r\n    }\r\n  },\r\n  created () {\r\n    this.getCoupons()\r\n  },\r\n  mixins: [ToastMessage]\r\n}\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}