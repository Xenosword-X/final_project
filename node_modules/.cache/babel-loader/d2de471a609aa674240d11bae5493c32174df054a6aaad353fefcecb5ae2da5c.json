{"ast":null,"code":"import CouponModal from '@/components/CouponModal.vue';\nimport DelModal from '@/components/DelModal.vue';\nimport ToastMessage from '@/mixins/ToastMessage';\nexport default {\n  components: {\n    CouponModal,\n    DelModal\n  },\n  /* props: {\r\n    config: Object\r\n  }, */\n  data() {\n    return {\n      coupons: {},\n      tempCoupon: {\n        title: '',\n        is_enabled: 0,\n        percent: 100,\n        code: ''\n      },\n      isLoading: false,\n      isNew: false\n    };\n  },\n  methods: {\n    getCoupons() {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`;\n      this.isLoading = true;\n      this.$http.get(api).then(res => {\n        this.coupons = res.data.coupons;\n        this.isLoading = false;\n      });\n    },\n    openCouponModal(isNew, item) {\n      this.isNew = isNew;\n      if (this.isNew) {\n        this.tempCoupon = {\n          due_date: new Date().getTime() / 1000\n        };\n      } else {\n        this.tempCoupon = {\n          ...item\n        };\n      }\n      this.$refs.couponModal.showModal();\n    },\n    openDelCouponModal(item) {\n      this.tempCoupon = {\n        ...item\n      };\n      const delComponent = this.$refs.delModal;\n      delComponent.showModal();\n    },\n    updateCoupon(tempCoupon) {\n      this.tempCoupon = tempCoupon;\n      let api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`;\n      let httpMethod = 'post';\n      // 如果不是新增，改用 put 並補上 id\n      if (!this.isNew) {\n        api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`;\n        httpMethod = 'put';\n      }\n      this.isLoading = true;\n      this.$http[httpMethod](api, {\n        data: this.tempCoupon\n      }).then(res => {\n        this.isLoading = false;\n        if (res.data.success) {\n          this.$refs.couponModal.hideModal();\n          this.getCoupons();\n          this.showToast('success', this.isNew ? '新增優惠券成功' : '更新優惠券成功');\n        } else {\n          this.showToast('error', this.isNew ? '新增優惠券失敗' : '更新優惠券失敗');\n        }\n      });\n    },\n    delCoupon() {\n      const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`;\n      this.isLoading = true;\n      this.$http.delete(url).then(response => {\n        console.log(response, this.tempCoupon);\n        const delComponent = this.$refs.delModal;\n        delComponent.hideModal();\n        this.getCoupons();\n      });\n    },\n    formatDate(timestamp) {\n      const date = new Date(timestamp * 1000);\n      return date.toISOString().split('T')[0];\n    }\n  },\n  created() {\n    this.getCoupons();\n  },\n  mixins: [ToastMessage]\n};","map":{"version":3,"names":["CouponModal","DelModal","ToastMessage","components","data","coupons","tempCoupon","title","is_enabled","percent","code","isLoading","isNew","methods","getCoupons","api","process","env","VUE_APP_API","VUE_APP_PATH","$http","get","then","res","openCouponModal","item","due_date","Date","getTime","$refs","couponModal","showModal","openDelCouponModal","delComponent","delModal","updateCoupon","httpMethod","id","success","hideModal","showToast","delCoupon","url","delete","response","console","log","formatDate","timestamp","date","toISOString","split","created","mixins"],"sources":["C:\\Users\\User\\Documents\\GitHub\\final_project\\src\\views\\Coupons.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\r\n<template>\r\n  <div>\r\n    <Loading :active=\"isLoading\" />\r\n\r\n    <div class=\"d-flex justify-content-between align-items-center my-4\">\r\n      <h2 class=\"h4 fw-bold mb-0\">優惠券管理</h2>\r\n      <button class=\"btn btn-primary d-flex align-items-center gap-1\" @click=\"openCouponModal(true)\">\r\n        <i class=\"bi bi-plus-circle\"></i> 建立新的優惠券\r\n      </button>\r\n    </div>\r\n\r\n    <div class=\"table-responsive\">\r\n      <table class=\"table table-hover align-middle text-nowrap\">\r\n        <thead class=\"table-light\">\r\n          <tr>\r\n            <th>名稱</th>\r\n            <th class=\"text-center\">折扣百分比</th>\r\n            <th class=\"text-center\">到期日</th>\r\n            <th class=\"text-center\">狀態</th>\r\n            <th class=\"text-center\">操作</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr v-for=\"(item, key) in coupons\" :key=\"key\">\r\n            <td>{{ item.title }}</td>\r\n            <td class=\"text-center\">{{ item.percent }}%</td>\r\n            <td class=\"text-center\">{{ formatDate(item.due_date) }}</td>\r\n            <td class=\"text-center\">\r\n              <span class=\"badge\" :class=\"item.is_enabled === 1 ? 'bg-success' : 'bg-secondary'\">\r\n                {{ item.is_enabled === 1 ? '啟用' : '未啟用' }}\r\n              </span>\r\n            </td>\r\n            <td class=\"text-center\">\r\n              <div class=\"btn-group\">\r\n                <button class=\"btn btn-outline-primary btn-sm\" @click=\"openCouponModal(false, item)\">\r\n                  <i class=\"bi bi-pencil-square\"></i> 編輯\r\n                </button>\r\n                <button class=\"btn btn-outline-danger btn-sm\" @click=\"openDelCouponModal(item)\">\r\n                  <i class=\"bi bi-trash\"></i> 刪除\r\n                </button>\r\n              </div>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n    <CouponModal :coupon=\"tempCoupon\" ref=\"couponModal\" :isNew=\"isNew\"\r\n      @update-coupon=\"updateCoupon\"\r\n    />\r\n    <DelModal :item=\"tempCoupon\" ref=\"delModal\" @del-item=\"delCoupon\"/>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport CouponModal from '@/components/CouponModal.vue'\r\nimport DelModal from '@/components/DelModal.vue'\r\nimport ToastMessage from '@/mixins/ToastMessage'\r\nexport default {\r\n  components: {\r\n    CouponModal,\r\n    DelModal\r\n  },\r\n  /* props: {\r\n    config: Object\r\n  }, */\r\n  data () {\r\n    return {\r\n      coupons: {},\r\n      tempCoupon: {\r\n        title: '',\r\n        is_enabled: 0,\r\n        percent: 100,\r\n        code: ''\r\n      },\r\n      isLoading: false,\r\n      isNew: false\r\n    }\r\n  },\r\n  methods: {\r\n    getCoupons () {\r\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`\r\n      this.isLoading = true\r\n      this.$http.get(api)\r\n        .then((res) => {\r\n          this.coupons = res.data.coupons\r\n          this.isLoading = false\r\n        })\r\n    },\r\n    openCouponModal (isNew, item) {\r\n      this.isNew = isNew\r\n      if (this.isNew) {\r\n        this.tempCoupon = {\r\n          due_date: new Date().getTime() / 1000\r\n        }\r\n      } else {\r\n        this.tempCoupon = { ...item }\r\n      }\r\n      this.$refs.couponModal.showModal()\r\n    },\r\n    openDelCouponModal (item) {\r\n      this.tempCoupon = { ...item }\r\n      const delComponent = this.$refs.delModal\r\n      delComponent.showModal()\r\n    },\r\n    updateCoupon (tempCoupon) {\r\n      this.tempCoupon = tempCoupon\r\n      let api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`\r\n      let httpMethod = 'post'\r\n      // 如果不是新增，改用 put 並補上 id\r\n      if (!this.isNew) {\r\n        api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`\r\n        httpMethod = 'put'\r\n      }\r\n      this.isLoading = true\r\n      this.$http[httpMethod](api, { data: this.tempCoupon })\r\n        .then((res) => {\r\n          this.isLoading = false\r\n          if (res.data.success) {\r\n            this.$refs.couponModal.hideModal()\r\n            this.getCoupons()\r\n            this.showToast(\r\n              'success',\r\n              this.isNew ? '新增優惠券成功' : '更新優惠券成功'\r\n            )\r\n          } else {\r\n            this.showToast(\r\n              'error',\r\n              this.isNew ? '新增優惠券失敗' : '更新優惠券失敗'\r\n            )\r\n          }\r\n        })\r\n    },\r\n    delCoupon () {\r\n      const url = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`\r\n      this.isLoading = true\r\n      this.$http.delete(url).then((response) => {\r\n        console.log(response, this.tempCoupon)\r\n        const delComponent = this.$refs.delModal\r\n        delComponent.hideModal()\r\n        this.getCoupons()\r\n      })\r\n    },\r\n    formatDate (timestamp) {\r\n      const date = new Date(timestamp * 1000)\r\n      return date.toISOString().split('T')[0]\r\n    }\r\n  },\r\n  created () {\r\n    this.getCoupons()\r\n  },\r\n  mixins: [ToastMessage]\r\n}\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}