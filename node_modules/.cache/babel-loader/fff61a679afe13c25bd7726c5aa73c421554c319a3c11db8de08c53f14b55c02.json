{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, vModelCheckbox as _vModelCheckbox, withDirectives as _withDirectives, createTextVNode as _createTextVNode, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"table-responsive\"\n};\nconst _hoisted_2 = {\n  class: \"table table-hover align-middle text-nowrap\"\n};\nconst _hoisted_3 = {\n  key: 0\n};\nconst _hoisted_4 = {\n  class: \"list-unstyled mb-0\"\n};\nconst _hoisted_5 = {\n  class: \"text-end\"\n};\nconst _hoisted_6 = {\n  class: \"text-center\"\n};\nconst _hoisted_7 = {\n  class: \"d-flex flex-column align-items-center\"\n};\nconst _hoisted_8 = {\n  class: \"form-check form-switch\"\n};\nconst _hoisted_9 = [\"id\", \"onUpdate:modelValue\", \"onChange\"];\nconst _hoisted_10 = {\n  class: \"text-center\"\n};\nconst _hoisted_11 = {\n  class: \"btn-group\"\n};\nconst _hoisted_12 = [\"onClick\"];\nconst _hoisted_13 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_Loading = _resolveComponent(\"Loading\");\n  const _component_OrderModal = _resolveComponent(\"OrderModal\");\n  const _component_DelModal = _resolveComponent(\"DelModal\");\n  const _component_Pagination = _resolveComponent(\"Pagination\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createVNode(_component_Loading, {\n    active: $data.isLoading\n  }, null, 8 /* PROPS */, [\"active\"]), _cache[3] || (_cache[3] = _createElementVNode(\"h2\", {\n    class: \"h4 fw-bold mt-4 mb-3\"\n  }, \"訂單管理\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"table\", _hoisted_2, [_cache[2] || (_cache[2] = _createElementVNode(\"thead\", {\n    class: \"table-light\"\n  }, [_createElementVNode(\"tr\", null, [_createElementVNode(\"th\", null, \"購買時間\"), _createElementVNode(\"th\", null, \"Email\"), _createElementVNode(\"th\", null, \"購買項目\"), _createElementVNode(\"th\", {\n    class: \"text-end\"\n  }, \"應付金額\"), _createElementVNode(\"th\", {\n    class: \"text-center\"\n  }, \"付款狀態\"), _createElementVNode(\"th\", {\n    class: \"text-center\"\n  }, \"操作\")])], -1 /* CACHED */)), $data.orders.length ? (_openBlock(), _createElementBlock(\"tbody\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.orders, (item, key) => {\n    return _openBlock(), _createElementBlock(\"tr\", {\n      key: key,\n      class: _normalizeClass({\n        'text-muted': !item.is_paid\n      })\n    }, [_createElementVNode(\"td\", null, _toDisplayString($options.formatDate(item.create_at)), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(item.user?.email || '無資料'), 1 /* TEXT */), _createElementVNode(\"td\", null, [_createElementVNode(\"ul\", _hoisted_4, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(item.products, (product, i) => {\n      return _openBlock(), _createElementBlock(\"li\", {\n        key: i\n      }, _toDisplayString(product.product.title) + \" × \" + _toDisplayString(product.qty) + \" \" + _toDisplayString(product.product.unit), 1 /* TEXT */);\n    }), 128 /* KEYED_FRAGMENT */))])]), _createElementVNode(\"td\", _hoisted_5, _toDisplayString(_ctx.$filters.currency(item.total)), 1 /* TEXT */), _createElementVNode(\"td\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"span\", {\n      class: _normalizeClass([\"badge mb-1\", item.is_paid ? 'bg-success' : 'bg-secondary'])\n    }, _toDisplayString(item.is_paid ? '已付款' : '未付款'), 3 /* TEXT, CLASS */), _createElementVNode(\"div\", _hoisted_8, [_withDirectives(_createElementVNode(\"input\", {\n      class: \"form-check-input\",\n      type: \"checkbox\",\n      id: `paidSwitch${item.id}`,\n      \"onUpdate:modelValue\": $event => item.is_paid = $event,\n      onChange: $event => $options.updatePaid(item)\n    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_9), [[_vModelCheckbox, item.is_paid]])])])]), _createElementVNode(\"td\", _hoisted_10, [_createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"button\", {\n      class: \"btn btn-outline-primary btn-sm\",\n      onClick: $event => $options.openModal(item)\n    }, [...(_cache[0] || (_cache[0] = [_createElementVNode(\"i\", {\n      class: \"bi bi-eye\"\n    }, null, -1 /* CACHED */), _createTextVNode(\" 檢視 \")]))], 8 /* PROPS */, _hoisted_12), _createElementVNode(\"button\", {\n      class: \"btn btn-outline-danger btn-sm\",\n      onClick: $event => $options.openDelOrderModal(item)\n    }, [...(_cache[1] || (_cache[1] = [_createElementVNode(\"i\", {\n      class: \"bi bi-trash\"\n    }, null, -1 /* CACHED */), _createTextVNode(\" 刪除 \")]))], 8 /* PROPS */, _hoisted_13)])])], 2 /* CLASS */);\n  }), 128 /* KEYED_FRAGMENT */))])) : _createCommentVNode(\"v-if\", true)])]), _createVNode(_component_OrderModal, {\n    order: $data.tempOrder,\n    ref: \"orderModal\",\n    onUpdatePaid: $options.updatePaid\n  }, null, 8 /* PROPS */, [\"order\", \"onUpdatePaid\"]), _createVNode(_component_DelModal, {\n    item: $data.tempOrder,\n    ref: \"delModal\",\n    onDelItem: $options.delOrder\n  }, null, 8 /* PROPS */, [\"item\", \"onDelItem\"]), _createVNode(_component_Pagination, {\n    pages: $data.pagination,\n    onEmitPages: $options.getOrders\n  }, null, 8 /* PROPS */, [\"pages\", \"onEmitPages\"])], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["class","_createVNode","_component_Loading","active","$data","isLoading","_createElementVNode","_hoisted_1","_hoisted_2","orders","length","_createElementBlock","_hoisted_3","_Fragment","_renderList","item","key","_normalizeClass","is_paid","_toDisplayString","$options","formatDate","create_at","user","email","_hoisted_4","products","product","i","title","qty","unit","_hoisted_5","_ctx","$filters","currency","total","_hoisted_6","_hoisted_7","_hoisted_8","type","id","$event","onChange","updatePaid","_hoisted_10","_hoisted_11","onClick","openModal","openDelOrderModal","_component_OrderModal","order","tempOrder","ref","onUpdatePaid","_component_DelModal","onDelItem","delOrder","_component_Pagination","pages","pagination","onEmitPages","getOrders"],"sources":["C:\\Users\\User\\Documents\\GitHub\\final_project\\src\\views\\Orders.vue"],"sourcesContent":["<!-- eslint-disable vue/multi-word-component-names -->\r\n<template>\r\n  <Loading :active=\"isLoading\" />\r\n\r\n  <h2 class=\"h4 fw-bold mt-4 mb-3\">訂單管理</h2>\r\n\r\n  <div class=\"table-responsive\">\r\n    <table class=\"table table-hover align-middle text-nowrap\">\r\n      <thead class=\"table-light\">\r\n        <tr>\r\n          <th>購買時間</th>\r\n          <th>Email</th>\r\n          <th>購買項目</th>\r\n          <th class=\"text-end\">應付金額</th>\r\n          <th class=\"text-center\">付款狀態</th>\r\n          <th class=\"text-center\">操作</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody v-if=\"orders.length\">\r\n        <tr v-for=\"(item, key) in orders\" :key=\"key\" :class=\"{ 'text-muted': !item.is_paid }\">\r\n          <td>{{ formatDate(item.create_at) }}</td>\r\n          <td>{{ item.user?.email || '無資料' }}</td>\r\n          <td>\r\n            <ul class=\"list-unstyled mb-0\">\r\n              <li v-for=\"(product, i) in item.products\" :key=\"i\">\r\n                {{ product.product.title }} × {{ product.qty }} {{ product.product.unit }}\r\n              </li>\r\n            </ul>\r\n          </td>\r\n          <td class=\"text-end\">{{ $filters.currency(item.total) }}</td>\r\n          <td class=\"text-center\">\r\n            <div class=\"d-flex flex-column align-items-center\">\r\n              <span\r\n                class=\"badge mb-1\"\r\n                :class=\"item.is_paid ? 'bg-success' : 'bg-secondary'\">\r\n                {{ item.is_paid ? '已付款' : '未付款' }}\r\n              </span>\r\n              <div class=\"form-check form-switch\">\r\n                <input\r\n                  class=\"form-check-input\"\r\n                  type=\"checkbox\"\r\n                  :id=\"`paidSwitch${item.id}`\"\r\n                  v-model=\"item.is_paid\"\r\n                  @change=\"updatePaid(item)\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </td>\r\n          <td class=\"text-center\">\r\n            <div class=\"btn-group\">\r\n              <button class=\"btn btn-outline-primary btn-sm\" @click=\"openModal(item)\">\r\n                <i class=\"bi bi-eye\"></i> 檢視\r\n              </button>\r\n              <button class=\"btn btn-outline-danger btn-sm\" @click=\"openDelOrderModal(item)\">\r\n                <i class=\"bi bi-trash\"></i> 刪除\r\n              </button>\r\n            </div>\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n\r\n  <OrderModal :order=\"tempOrder\" ref=\"orderModal\" @update-paid=\"updatePaid\"/>\r\n  <DelModal :item=\"tempOrder\" ref=\"delModal\" @del-item=\"delOrder\"/>\r\n  <Pagination :pages=\"pagination\" @emit-pages=\"getOrders\"/>\r\n</template>\r\n\r\n<script>\r\nimport DelModal from '@/components/DelModal.vue'\r\nimport OrderModal from '@/components/OrderModal.vue'\r\nimport Pagination from '@/components/Pagination.vue'\r\nexport default {\r\n  data () {\r\n    return {\r\n      orders: [],\r\n      pagination: {},\r\n      isLoading: false,\r\n      tempOrder: {}\r\n    }\r\n  },\r\n  components: {\r\n    DelModal,\r\n    OrderModal,\r\n    Pagination\r\n  },\r\n  methods: {\r\n    getOrders (page = 1) {\r\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/orders?page=${page}`\r\n      this.isLoading = true\r\n      this.$http.get(api)\r\n        .then(res => {\r\n          if (res.data.success) {\r\n            this.isLoading = false\r\n            this.orders = res.data.orders\r\n            this.pagination = res.data.pagination\r\n          }\r\n        })\r\n    },\r\n    openModal (item) {\r\n      this.tempOrder = { ...item }\r\n      const orderComponent = this.$refs.orderModal\r\n      orderComponent.showModal()\r\n    },\r\n    openDelOrderModal (item) {\r\n      this.tempProduct = { ...item }\r\n      const delComponent = this.$refs.delModal\r\n      delComponent.showModal()\r\n    },\r\n    updatePaid (item) {\r\n      this.isLoading = true\r\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/order/${item.id}`\r\n      const paid = {\r\n        is_paid: item.is_paid\r\n      }\r\n      this.$http.put(api, { data: paid })\r\n        .then(res => {\r\n          this.isLoading = false\r\n          this.getOrders()\r\n        })\r\n    },\r\n    delOrder () {\r\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/order/${this.tempOrder.id}`\r\n      this.$http.delete(api)\r\n        .then(res => {\r\n          const delComponent = this.$refs.delModal\r\n          delComponent.hideModal()\r\n          this.getOrders()\r\n        })\r\n    },\r\n    formatDate (timestamp) {\r\n      const num = Number(timestamp)\r\n      if (!num || isNaN(num)) {\r\n        return '無效時間'\r\n      }\r\n      const date = new Date(num * 1000)\r\n      return date.toISOString().split('T')[0]\r\n    }\r\n  },\r\n  created () {\r\n    this.getOrders()\r\n  }\r\n}\r\n</script>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}